@page "/coaches"
@using HorsesForCourses.Blazor.Pages.CoachComponents

<PageTitle>Coaches</PageTitle>

<h1>Coaches</h1>

<button class="btn btn-primary mb-3" @onclick="ShowAddCoachModal">Add Coach</button>

@if (error != null)
{
    <p class="text-danger">@error</p>
}
else if (coaches == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Courses Assigned</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var coach in coaches)
            {
                <CoachRow Coach="coach"
                          OnToggleDetails="() => ToggleCoachDetails(coach.Id)"
                          OnEdit="() => ShowEditCoachModal(coach.Id)"
                          OnDelete="() => ShowDeleteConfirmModal(coach.Id)" />
                
                @if (expandedCoachIds.Contains(coach.Id))
                {
                    <tr>
                        <td colspan="4" style="background-color: #f8f9fa;">
                            @if (coachDetailsCache.TryGetValue(coach.Id, out var details))
                            {
                                <CoachDetails Details="details" />
                            }
                            else
                            {
                                <p><em>Loading details...</em></p>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
}

@if (showAddCoachModal)
{
    <AddCoachForm OnValidSubmit="HandleCoachAdded" OnClose="HideAddCoachModal" />
}

@if (showEditCoachModal && editingCoach != null)
{
    <EditCoachForm EditingCoach="editingCoach"
                   OnCoachUpdated="HandleCoachUpdated"
                   OnCancel="HideEditCoachModal" />
}

@if (showConfirmDeleteModal)
{
    <ConfirmDialog Title="Delete Coach"
                   Message=@($"Are you sure you want to delete this coach?")
                   OnConfirm="HandleDeleteConfirmed"
                   OnCancel="HideDeleteConfirmModal" />
}
